# Решение задачки 1 из файла testtask.pdf
Это один и тот же исполняемый файл что для клиента, что для контроллера.

Собрать на линуксе можно командой
```
$ make
```
А не на линуксе не можно.

Режим задается аргументом -m

контроллер:
```
$ ./module -i "192.168.0.213" -m controller
```

клиент:
```
$ ./module -i "192.168.0.213" -m client
```
По техническим причинам с флагом -i указывается адрес исходящего интерфейса.

## Алгоритм отказа контроллера
Лучше бы картинку нарисовать...

Изначально клиенты подключаются к сети и начинают широковещательно заявлять о своем присутствии.
Если контроллер их слышит, то он к ним подключается. Превышения числа ошибок обмена/обрыв соединиения приводит к отключению клиента. Если клиент долго не видит опросов температуры/освещенности, либо рвется соединение с контроллером, то он снова переходит в режим широковещания.

Если к клиенту в течении некоторого промежутка времени не подключается контроллер, то клиент пытается стать контроллером. Решение принимается путем хранения в связном списке широковещательных оповещений других клиентов. Если у клиента минимальный ip адрес, то он становится контроллером. При этом новый вторичный контроллер не оставляет попыток связаться с главным контроллером. Он продолжает заявлять о себе, правда не широковещательно. Для простоты главным в системе считается контроллер с захардкоженным ip адресом. Тупо. Если он снова становится активен, то вторичный контроллер отключается от клиентов и к нему подключается главный. Осиротевшие клиенты тоже переходят в режим оповещения и оказываются подключенными к главному контроллеру.

# Проблемы
А теперь о главном. Много чего еще хорошо бы причесать, но для тестовой задачки сойдет. Осталось незаконченных пара ерундовых моментов. Не реализована команда отсылки данных из контроллера в клиент, данные температуры не усредняются. Сделаю на досуге, это совсем просто.
Временные интервалы я уменьшил, чтобы не ждать таймаутов всю жизнь.
Я изначально думал, что у меня получится запустить несколько клиентов на одной машине, но из-за мультикастного сокета, который нужен в программе, не получается. Морочиться с кучей виртуалок не стал и просто отладил, что смог, на двух машинах.
